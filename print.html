<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CraftBeerPi Hat</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="hardware_setup.html"><strong aria-hidden="true">2.</strong> Hardware Setup</a></li><li class="chapter-item expanded "><a href="software_setup.html"><strong aria-hidden="true">3.</strong> Software Setup</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CraftBeerPi Hat</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hardware-setup"><a class="header" href="#hardware-setup">Hardware Setup</a></h1>
<p>The board itself has been designed with ease of use in mind. However certain things need
to be considered.</p>
<p><img src="hardware.png" alt="Overview" /></p>
<h2 id="power"><a class="header" href="#power">Power</a></h2>
<p>First of all please use a proper power supply to power the board. In theory every output
can provide up to 1 amp and the Rasperry Pi could draw up to 3 amp. So in total the board might
require up to 10 amp to be provided by the PSU. Please calculate your actual power requirements
and provide proper fusing on the power input as currently only the outputs have fuses but not
the overall board itself.</p>
<p>When deciding for the voltage it is best to consider what voltage you need on the outputs as the 
outputs will directly output the input voltage. The hat will convert every input voltage between
12V and 24V into 5V for the Raspberry Pi. There is no need to power the Raspberry Pi through USB.
So please do not power the Raspberry Pi via USB when using the hat, as this might damage the
Raspberry Pi and/or the hat.</p>
<h2 id="polarity"><a class="header" href="#polarity">Polarity</a></h2>
<p>Even though the board has reverse voltage protection on its input, polarity is important for
successful operation. When looking at the front of a screw terminal the negative side is always left
and the positive side is always right. This is true for the input connector and all output screw 
terminals. There are also markings <code>+</code> and <code>-</code> next to connectors if there is space for that on the
top side. On the bottom side the polarity and numbering of all connectors is marked in full.</p>
<h2 id="max31865-for-pt100pt1000"><a class="header" href="#max31865-for-pt100pt1000">MAX31865 for PT100/PT1000</a></h2>
<p>On the board are five slots for MAX31865 modules like the ones from <a href="https://www.adafruit.com/product/3328">Adafruit</a>.
Slots 1,2,3 and 5 are oriented in the same direction with the MAX31865 modules top side facing to the left. Slot 4 is
reversed for space saving reasons and is therefore facing to the right.</p>
<p>In CraftBeerPi you need to configure for each module you have plugged in and want to use the correct chip enable.
The GPIOs used as chip enable for each slot are marked in the overview picture, but here is additionally a handy
table:</p>
<div class="table-wrapper"><table><thead><tr><th>Module #</th><th>GPIO CS</th></tr></thead><tbody>
<tr><td>1</td><td>17</td></tr>
<tr><td>2</td><td>27</td></tr>
<tr><td>3</td><td>22</td></tr>
<tr><td>4</td><td>5</td></tr>
<tr><td>5</td><td>6</td></tr>
</tbody></table>
</div>
<h2 id="rtc"><a class="header" href="#rtc">RTC</a></h2>
<p>For the RTC to properly work you need to insert a CR2032 battery into the battery holder. The polarity is marked on the board.</p>
<h2 id="outputs"><a class="header" href="#outputs">Outputs</a></h2>
<p>The board has 7 different powered outputs to drive GPIO actors. Every output outputs the input voltage with up to 1 amp to drive
SSRs, relays, solenoids etc. For loads like relays and solenoids the polarity should not matter. For other loads the polarity is the
same as on the input (left negative side, right positive side).</p>
<p><strong>All outputs are inverted, meaning that they are active when the GPIO is driven low and vice versa!</strong><br />
<strong>Ensure that you select &quot;Inverted&quot; &quot;Yes&quot; when configuring the GPIO actor in CraftBeerPi!</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="software-setup"><a class="header" href="#software-setup">Software setup</a></h1>
<p>To properly operate this board and make use of all its features a few things need to be
considered on the software side as well.</p>
<h2 id="rtc-1"><a class="header" href="#rtc-1">RTC</a></h2>
<p>The RTC on this board is a DS3231 and well supported by all Linux kernels. To make use of the RTC
you need to enable I2C and use the proper devive tree overlay to let the kernel know about the
availability of the RTC. To do this simply add the lines to the <code>config.txt</code> of your Raspberry Pi
installation</p>
<pre><code>dtparam=i2c_arm=on
dtoverlay=i2c-rtc,ds3231
</code></pre>
<h2 id="onewire"><a class="header" href="#onewire">OneWire</a></h2>
<p>OneWire support needs to be enabled as well for the kernel to be usable by userland applicartions like
CraftBeerPi. The OneWire data line is connected to <code>GPIO4</code> on the Raspberry Pi. To enable OneWire support
simply add the following line to your <code>config.txt</code></p>
<pre><code>dtoverlay=w1-gpio,gpiopin=4
</code></pre>
<h2 id="spi-max31865"><a class="header" href="#spi-max31865">SPI (MAX31865)</a></h2>
<p>The MAX31865 modules are connected via SPI on the bus SPI0 on the Raspberry Pi. To enable SPI support
add the following lines to your <code>config.txt</code></p>
<pre><code>dtparam=spi=on
dtoverlay=spi0-0cs
</code></pre>
<p>We need to disable the chip enable pins of the SPI0 bus, because they would only support 2 devices and
this board supports up to 5 MAX31865. The GPIO formerly used us chip enable are used to control output
2 and 3.</p>
<p>When configuring the MAX31865 modules in CraftBeerPi you need to specify the chip enable pin for each
module. The following table maps the numbered module slot to the correct GPIO serving as the chip enable
pin:</p>
<div class="table-wrapper"><table><thead><tr><th>Module #</th><th>GPIO CS</th></tr></thead><tbody>
<tr><td>1</td><td>17</td></tr>
<tr><td>2</td><td>27</td></tr>
<tr><td>3</td><td>22</td></tr>
<tr><td>4</td><td>5</td></tr>
<tr><td>5</td><td>6</td></tr>
</tbody></table>
</div>
<h2 id="gpio"><a class="header" href="#gpio">GPIO</a></h2>
<p>The digital outputs are controlled by GPIO pins. Please note that the outputs are inverted, meaning that if
the GPIO is high the output is disabled and vice versa. To bring the GPIO pins controlling the outputs as soon
as possible on a defined high state and therefore disabling the outputs during boot please add the following
line to your <code>config.txt</code></p>
<pre><code>gpio=25,7,8,12,16,20,21=op,dh
</code></pre>
<p>When configuring GPIO actors in CraftBeerPi please ensure that you specify &quot;Yes&quot; for the field &quot;Inverted&quot;!
The following table maps the GPIO pin numbers to the numbered outputs</p>
<div class="table-wrapper"><table><thead><tr><th>Output #</th><th>GPIO</th></tr></thead><tbody>
<tr><td>1</td><td>25</td></tr>
<tr><td>2</td><td>8</td></tr>
<tr><td>3</td><td>7</td></tr>
<tr><td>4</td><td>12</td></tr>
<tr><td>5</td><td>16</td></tr>
<tr><td>6</td><td>20</td></tr>
<tr><td>7</td><td>21</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
